(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ucenter/userinfo/userinfo"],{"0424":function(e,n,t){"use strict";(function(e,i){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=r(t("a34a")),u=t("26cb");function r(e){return e&&e.__esModule?e:{default:e}}function s(e,n,t,i,o,u,r){try{var s=e[u](r),a=s.value}catch(c){return void t(c)}s.done?n(a):Promise.resolve(a).then(i,o)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(i,o){var u=e.apply(n,t);function r(e){s(u,i,o,r,a,"next",e)}function a(e){s(u,i,o,r,a,"throw",e)}r(void 0)}))}}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){f(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function f(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var d=e.database(),p=d.collection("uni-id-users"),h={data:function(){return{univerifyStyle:{authButton:{title:"本机号码一键绑定"},otherLoginButton:{title:"其他号码绑定"}}}},onLoad:function(){this.univerifyStyle.authButton.title=this.$t("userinfo.bindPhoneNumber"),this.univerifyStyle.otherLoginButton.title=this.$t("userinfo.bindOtherLogin"),i.setNavigationBarTitle({title:this.$t("userinfo.navigationBarTitle")})},computed:l(l({},(0,u.mapGetters)({userInfo:"user/info",login:"user/hasLogin"})),{},{avatar_file:function(){if(this.userInfo.avatar_file&&this.userInfo.avatar_file.url)return this.userInfo.avatar_file}}),methods:l(l({},(0,u.mapMutations)({setUserInfo:"user/login"})),{},{bindMobile:function(){this.$refs["uni-bindMobileByMpWeixin"].open()},univerify:function(){var n=this;i.login({provider:"univerify",univerifyStyle:this.univerifyStyle,success:function(){var t=a(o.default.mark((function t(u){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(u.authResult),e.callFunction({name:"uni-id-cf",data:{action:"bindMobileByUniverify",params:u.authResult},success:function(e){var t=e.result;console.log(t),0===t.code?(n.setUserInfo({mobile:t.mobile}),i.closeAuthView()):i.showModal({content:t.msg,showCancel:!1,complete:function(){i.closeAuthView()}})}});case 2:case"end":return t.stop()}}),t)})));function u(e){return t.apply(this,arguments)}return u}(),fail:function(e){console.log(e),"30002"!=e.code&&"30001"!=e.code||n.bindMobileBySmsCode()}})},bindMobileBySmsCode:function(){i.navigateTo({url:"/pages/ucenter/userinfo/bind-mobile/bind-mobile"})},setNickname:function(e){var n=this;console.log(e),e?(p.where("_id==$env.uid").update({nickname:e}).then((function(t){console.log(t),t.result.updated?(i.showToast({title:n.$t("common.updateSucceeded"),icon:"none"}),n.setUserInfo({nickname:e})):i.showToast({title:n.$t("userinfo.noChange"),icon:"none"})})),this.$refs.dialog.close()):this.$refs.dialog.open()},setAvatarFile:function(e){var n=this;i.showLoading({title:this.$t("userinfo.setting"),mask:!0}),p.where("_id==$env.uid").update({avatar_file:e}).then((function(t){console.log(t),e?i.showToast({icon:"none",title:n.$t("userinfo.setSucceeded")}):i.showToast({icon:"none",title:n.$t("userinfo.deleteSucceeded")}),n.setUserInfo({avatar_file:e})})).catch((function(e){i.showModal({content:e.message||n.$t("userinfo.requestFail"),showCancel:!1})})).finally((function(){i.hideLoading()}))},uploadAvatarImg:function(n){var t=this,u={quality:100,width:600,height:600,resize:!0};i.chooseImage({count:1,crop:u,success:function(){var n=a(o.default.mark((function n(r){var s,a,c,l,f,d;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log(r),s=r.tempFiles[0],a={extname:s.path.split(".")[s.path.split(".").length-1]},c=r.tempFilePaths[0],n.next=4,new Promise((function(e){i.navigateTo({url:"/pages/ucenter/userinfo/cropImage?path="+c+"&options=".concat(JSON.stringify(u)),animationType:"fade-in",events:{success:function(n){e(n)}}})}));case 4:return c=n.sent,console.log(t.userInfo),l=t.userInfo._id+""+Date.now(),a.name=l,i.showLoading({title:t.$t("userinfo.uploading"),mask:!0}),n.next=11,e.uploadFile({filePath:c,cloudPath:l,fileType:"image"});case 11:f=n.sent,d=f.fileID,a.url=d,console.log({avatar_file:a}),i.hideLoading(),t.setAvatarFile(a);case 17:case"end":return n.stop()}}),n)})));function r(e){return n.apply(this,arguments)}return r}()})}})};n.default=h}).call(this,t("a9ff")["default"],t("543d")["default"])},"4a32":function(e,n,t){"use strict";(function(e){t("31b5"),t("a9ff");i(t("66fd"));var n=i(t("5e0c"));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},"59bc":function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return u})),t.d(n,"a",(function(){return i}));var i={uniList:function(){return t.e("uni_modules/uni-list/components/uni-list/uni-list").then(t.bind(null,"c62a"))},uniListItem:function(){return t.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(t.bind(null,"58dc"))},cloudImage:function(){return t.e("components/cloud-image/cloud-image").then(t.bind(null,"be4f"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"0e0f"))},uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,"e87b"))},uniPopupDialog:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(t.bind(null,"9d71"))},uniBindMobileByMpWeixin:function(){return t.e("components/uni-bindMobileByMpWeixin/uni-bindMobileByMpWeixin").then(t.bind(null,"a263"))}},o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.$t("userinfo.ProfilePhoto")),i=e.$t("userinfo.nickname"),o=e.userInfo.nickname||e.$t("userinfo.notSet"),u=e.$t("userinfo.phoneNumber"),r=e.userInfo.mobile||e.$t("userinfo.notSpecified"),s=e.$t("userinfo.setNickname"),a=e.$t("userinfo.setNicknamePlaceholder");e.$mp.data=Object.assign({},{$root:{m0:t,m1:i,m2:o,m3:u,m4:r,m5:s,m6:a}})},u=[]},"5e0c":function(e,n,t){"use strict";t.r(n);var i=t("59bc"),o=t("9ee0");for(var u in o)"default"!==u&&function(e){t.d(n,e,(function(){return o[e]}))}(u);t("7e4f");var r,s=t("f0c5"),a=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"d108c796",null,!1,i["a"],r);n["default"]=a.exports},"7e4f":function(e,n,t){"use strict";var i=t("95b8"),o=t.n(i);o.a},"95b8":function(e,n,t){},"9ee0":function(e,n,t){"use strict";t.r(n);var i=t("0424"),o=t.n(i);for(var u in i)"default"!==u&&function(e){t.d(n,e,(function(){return i[e]}))}(u);n["default"]=o.a}},[["4a32","common/runtime","common/vendor"]]]);