{"version":3,"sources":["uni-app:///main.js","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?aa7f","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?b933","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?e8d7","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?b6b7","uni-app:///uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?e3fd","webpack:///D:/uniappprojrcy/校园生活助手/uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue?2f2b"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"uni_modules/uni-upgrade-center-app/pages/upgrade-popup.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./upgrade-popup.vue?vue&type=template&id=3858945d&\"\nvar renderjs\nimport script from \"./upgrade-popup.vue?vue&type=script&lang=js&\"\nexport * from \"./upgrade-popup.vue?vue&type=script&lang=js&\"\nimport style0 from \"./upgrade-popup.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/uni-upgrade-center-app/pages/upgrade-popup.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upgrade-popup.vue?vue&type=template&id=3858945d&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upgrade-popup.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upgrade-popup.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"mask flex-center\">\r\n\t\t<view class=\"content botton-radius\">\r\n\t\t\t<view class=\"content-top\">\r\n\t\t\t\t<text class=\"content-top-text\">{{title}}</text>\r\n\t\t\t\t<image class=\"content-top\" style=\"top: 0;\" width=\"100%\" height=\"100%\" src=\"../images/bg_top.png\">\r\n\t\t\t\t</image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"content-header\"></view>\r\n\t\t\t<view class=\"content-body\">\r\n\t\t\t\t<view class=\"title\">\r\n\t\t\t\t\t<text>{{subTitle}}</text>\r\n\t\t\t\t\t<!-- <text style=\"padding-left:20rpx;font-size: 0.5em;color: #666;\">v.{{version}}</text> -->\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"body\">\r\n\t\t\t\t\t<scroll-view class=\"box-des-scroll\" scroll-y=\"true\">\r\n\t\t\t\t\t\t<text class=\"box-des\">\r\n\t\t\t\t\t\t\t{{contents}}\r\n\t\t\t\t\t\t</text>\r\n\t\t\t\t\t</scroll-view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"footer flex-center\">\r\n\t\t\t\t\t<template v-if=\"isiOS\">\r\n\t\t\t\t\t\t<button class=\"content-button\" style=\"border: none;color: #fff;\" plain @click=\"jumpToAppStore\">\r\n\t\t\t\t\t\t\t{{downLoadBtnTextiOS}}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t<template v-if=\"!downloadSuccess\">\r\n\t\t\t\t\t\t\t<view class=\"progress-box flex-column\" v-if=\"downloading\">\r\n\t\t\t\t\t\t\t\t<progress class=\"progress\" border-radius=\"35\" :percent=\"downLoadPercent\"\r\n\t\t\t\t\t\t\t\t\tactiveColor=\"#3DA7FF\" show-info stroke-width=\"10\" />\r\n\t\t\t\t\t\t\t\t<view style=\"width:100%;font-size: 28rpx;display: flex;justify-content: space-around;\">\r\n\t\t\t\t\t\t\t\t\t<text>{{downLoadingText}}</text>\r\n\t\t\t\t\t\t\t\t\t<text>({{downloadedSize}}/{{packageFileSize}}M)</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t<button v-else class=\"content-button\" style=\"border: none;color: #fff;\" plain\r\n\t\t\t\t\t\t\t\t@click=\"downloadPackage\">\r\n\t\t\t\t\t\t\t\t{{downLoadBtnText}}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<button v-else-if=\"downloadSuccess && !installed\" class=\"content-button\"\r\n\t\t\t\t\t\t\tstyle=\"border: none;color: #fff;\" plain :loading=\"installing\" :disabled=\"installing\"\r\n\t\t\t\t\t\t\t@click=\"installPackage\">\r\n\t\t\t\t\t\t\t{{installing ? '正在安装……' : '下载完成，立即安装'}}\r\n\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t<button v-if=\"installed && isWGT\" class=\"content-button\" style=\"border: none;color: #fff;\" plain\r\n\t\t\t\t\t\t\t@click=\"restart\">\r\n\t\t\t\t\t\t\t安装完毕，点击重启\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<image v-if=\"!is_mandatory\" class=\"close-img\" src=\"../images/app_update_close.png\"\r\n\t\t\t\t@click.stop=\"closeUpdate\"></image>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst localFilePathKey = '__localFilePath__'\r\n\tconst platform_iOS = 'iOS';\r\n\tlet downloadTask = null;\r\n\r\n\t/**\r\n\t * 对比版本号，如需要，请自行修改判断规则\r\n\t * 支持比对\t(\"3.0.0.0.0.1.0.1\", \"3.0.0.0.0.1\")\t(\"3.0.0.1\", \"3.0\")\t(\"3.1.1\", \"3.1.1.1\") 之类的\r\n\t * @param {Object} v1\r\n\t * @param {Object} v2\r\n\t * v1 > v2 return 1\r\n\t * v1 < v2 return -1\r\n\t * v1 == v2 return 0\r\n\t */\r\n\tfunction compare(v1 = '0', v2 = '0') {\r\n\t\tv1 = String(v1).split('.')\r\n\t\tv2 = String(v2).split('.')\r\n\t\tconst minVersionLens = Math.min(v1.length, v2.length);\r\n\r\n\t\tlet result = 0;\r\n\t\tfor (let i = 0; i < minVersionLens; i++) {\r\n\t\t\tconst curV1 = Number(v1[i])\r\n\t\t\tconst curV2 = Number(v2[i])\r\n\r\n\t\t\tif (curV1 > curV2) {\r\n\t\t\t\tresult = 1\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(curV1 < curV2) {\r\n\t\t\t\tresult = -1\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (result === 0 && (v1.length !== v2.length)) {\r\n\t\t\tconst v1BiggerThenv2 = v1.length > v2.length;\r\n\t\t\tconst maxLensVersion = v1BiggerThenv2 ? v1 : v2;\r\n\t\t\tfor (let i = minVersionLens; i < maxLensVersion.length; i++) {\r\n\t\t\t\tconst curVersion = Number(maxLensVersion[i])\r\n\t\t\t\tif (curVersion > 0) {\r\n\t\t\t\t\tv1BiggerThenv2 ? result = 1 : result = -1\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 从之前下载安装\r\n\t\t\t\tinstallForBeforeFilePath: '',\r\n\r\n\t\t\t\t// 安装\r\n\t\t\t\tinstalled: false,\r\n\t\t\t\tinstalling: false,\r\n\r\n\t\t\t\t// 下载\r\n\t\t\t\tdownloadSuccess: false,\r\n\t\t\t\tdownloading: false,\r\n\r\n\t\t\t\tdownLoadPercent: 0,\r\n\t\t\t\tdownloadedSize: 0,\r\n\t\t\t\tpackageFileSize: 0,\r\n\r\n\t\t\t\ttempFilePath: '', // 要安装的本地包地址\r\n\r\n\t\t\t\t// 默认安装包信息\r\n\t\t\t\ttitle: '更新日志',\r\n\t\t\t\tcontents: '',\r\n\t\t\t\tis_mandatory: false,\r\n\r\n\t\t\t\t// 可自定义属性\r\n\t\t\t\tsubTitle: '发现新版本',\r\n\t\t\t\tdownLoadBtnTextiOS: '立即跳转更新',\r\n\t\t\t\tdownLoadBtnText: '立即下载更新',\r\n\t\t\t\tdownLoadingText: '安装包下载中，请稍后'\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad({\r\n\t\t\tlocal_storage_key\r\n\t\t}) {\r\n\t\t\tif (!local_storage_key) {\r\n\t\t\t\tconsole.error('local_storage_key为空，请检查后重试')\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\r\n\t\t\tconst localPackageInfo = uni.getStorageSync(local_storage_key);\r\n\t\t\tif (!localPackageInfo) {\r\n\t\t\t\tconsole.error('安装包信息为空，请检查后重试')\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\r\n\t\t\tconst requiredKey = ['version', 'url', 'type']\r\n\t\t\tfor (let key in localPackageInfo) {\r\n\t\t\t\tif (requiredKey.indexOf(key) !== -1 && !localPackageInfo[key]) {\r\n\t\t\t\t\tconsole.error(`参数 ${key} 必填，请检查后重试`)\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tObject.assign(this, localPackageInfo)\r\n\t\t\tthis.checkLocalStoragePackage()\r\n\t\t},\r\n\t\tonBackPress() {\r\n\t\t\t// 强制更新不允许返回\r\n\t\t\tif (this.is_mandatory) {\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\r\n\t\t\tdownloadTask && downloadTask.abort()\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tisWGT() {\r\n\t\t\t\treturn this.type === 'wgt'\r\n\t\t\t},\r\n\t\t\tisiOS() {\r\n\t\t\t\treturn !this.isWGT ? this.platform.includes(platform_iOS) : false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tcheckLocalStoragePackage() {\r\n\t\t\t\t// 如果已经有下载好的包，则直接提示安装\r\n\t\t\t\tconst localFilePathRecord = uni.getStorageSync(localFilePathKey)\r\n\t\t\t\tif (localFilePathRecord) {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tversion,\r\n\t\t\t\t\t\tsavedFilePath,\n\t\t\t\t\t\tinstalled\r\n\t\t\t\t\t} = localFilePathRecord\n\t\t\t\t\t\r\n\t\t\t\t\t// 比对版本\r\n\t\t\t\t\tif (!installed && compare(version, this.version) === 0) {\r\n\t\t\t\t\t\tthis.downloadSuccess = true;\r\n\t\t\t\t\t\tthis.installForBeforeFilePath = savedFilePath;\r\n\t\t\t\t\t\tthis.tempFilePath = savedFilePath\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 如果保存的包版本小 或 已安装过，则直接删除\r\n\t\t\t\t\t\tthis.deleteSavedFile(savedFilePath)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync closeUpdate() {\r\n\t\t\t\tif (this.downloading) {\r\n\t\t\t\t\tif (this.is_mandatory) {\r\n\t\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\t\ttitle: '下载中，请稍后……',\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 500\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '是否取消下载？',\r\n\t\t\t\t\t\tcancelText: '否',\r\n\t\t\t\t\t\tconfirmText: '是',\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\tdownloadTask && downloadTask.abort()\r\n\t\t\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.downloadSuccess && this.tempFilePath) {\r\n\t\t\t\t\t// 包已经下载完毕，稍后安装，将包保存在本地\r\n\t\t\t\t\tawait this.saveFile(this.tempFilePath, this.version)\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t},\r\n\t\t\tdownloadPackage() {\r\n\t\t\t\tthis.downloading = true;\r\n\r\n\t\t\t\t//下载包\r\n\t\t\t\tdownloadTask = uni.downloadFile({\r\n\t\t\t\t\turl: this.url,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.statusCode == 200) {\r\n\t\t\t\t\t\t\tthis.downloadSuccess = true;\r\n\t\t\t\t\t\t\tthis.tempFilePath = res.tempFilePath\r\n\r\n\t\t\t\t\t\t\t// 强制更新，直接安装\r\n\t\t\t\t\t\t\tif (this.is_mandatory) {\r\n\t\t\t\t\t\t\t\tthis.installPackage();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.downloading = false;\r\n\r\n\t\t\t\t\t\tthis.downLoadPercent = 0\r\n\t\t\t\t\t\tthis.downloadedSize = 0\r\n\t\t\t\t\t\tthis.packageFileSize = 0\r\n\r\n\t\t\t\t\t\tdownloadTask = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdownloadTask.onProgressUpdate(res => {\r\n\t\t\t\t\tthis.downLoadPercent = res.progress;\r\n\t\t\t\t\tthis.downloadedSize = (res.totalBytesWritten / Math.pow(1024, 2)).toFixed(2);\r\n\t\t\t\t\tthis.packageFileSize = (res.totalBytesExpectedToWrite / Math.pow(1024, 2)).toFixed(2);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinstallPackage() {\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t// wgt资源包安装\r\n\t\t\t\tif (this.isWGT) {\r\n\t\t\t\t\tthis.installing = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tplus.runtime.install(this.tempFilePath, {\r\n\t\t\t\t\tforce: false\r\n\t\t\t\t}, async res => {\r\n\t\t\t\t\tthis.installing = false;\r\n\t\t\t\t\tthis.installed = true;\r\n\r\n\t\t\t\t\t// wgt包，安装后会提示 安装成功，是否重启\r\n\t\t\t\t\tif (this.isWGT) {\r\n\t\t\t\t\t\t// 强制更新安装完成重启\r\n\t\t\t\t\t\tif (this.is_mandatory) {\r\n\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\ttitle: '安装成功，正在重启……'\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\tthis.restart();\r\n\t\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst localFilePathRecord = uni.getStorageSync(localFilePathKey)\n\t\t\t\t\t\tuni.setStorageSync(localFilePathKey, {\n\t\t\t\t\t\t\t...localFilePathRecord,\n\t\t\t\t\t\t\tinstalled: true\n\t\t\t\t\t\t})\n\t\t\t\t\t}\r\n\t\t\t\t}, async err => {\r\n\t\t\t\t\t// 如果是安装之前的包，安装失败后删除之前的包\r\n\t\t\t\t\tif (this.installForBeforeFilePath) {\r\n\t\t\t\t\t\tawait this.deleteSavedFile(this.installForBeforeFilePath)\r\n\t\t\t\t\t\tthis.installForBeforeFilePath = '';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 安装失败需要重新下载安装包\r\n\t\t\t\t\tthis.installing = false;\r\n\t\t\t\t\tthis.installed = false;\r\n\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: `更新失败${this.isWGT ? '' : '，APK文件不存在'}，请重新下载`,\r\n\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 非wgt包，安装跳出覆盖安装，此处直接返回上一页\r\n\t\t\t\tif (!this.isWGT) {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\trestart() {\r\n\t\t\t\tthis.installed = false;\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t//更新完重启app\r\n\t\t\t\tplus.runtime.restart();\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tasync saveFile(tempFilePath, version) {\r\n\t\t\t\tconst [err, res] = await uni.saveFile({\r\n\t\t\t\t\ttempFilePath\r\n\t\t\t\t})\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tuni.setStorageSync(localFilePathKey, {\r\n\t\t\t\t\tversion,\r\n\t\t\t\t\tsavedFilePath: res.savedFilePath\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdeleteSavedFile(filePath) {\r\n\t\t\t\tuni.removeStorageSync(localFilePathKey)\r\n\t\t\t\treturn uni.removeSavedFile({\r\n\t\t\t\t\tfilePath\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tjumpToAppStore() {\r\n\t\t\t\tplus.runtime.openURL(this.url);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\tpage {\r\n\t\tbackground: transparent;\r\n\t}\r\n\r\n\t.flex-center {\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tdisplay: flex;\r\n\t\t/* #endif */\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.mask {\r\n\t\tposition: fixed;\r\n\t\tleft: 0;\r\n\t\ttop: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, .65);\r\n\t}\r\n\r\n\t.botton-radius {\r\n\t\tborder-bottom-left-radius: 30rpx;\r\n\t\tborder-bottom-right-radius: 30rpx;\r\n\t}\r\n\r\n\t.content {\r\n\t\tposition: relative;\r\n\t\ttop: 0;\r\n\t\twidth: 600rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0 50rpx;\r\n\t\tfont-family: Source Han Sans CN;\r\n\t}\r\n\r\n\t.text {\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tdisplay: block;\r\n\t\t/* #endif */\r\n\t\tline-height: 200px;\r\n\t\ttext-align: center;\r\n\t\tcolor: #FFFFFF;\r\n\t}\r\n\r\n\t.content-top {\r\n\t\tposition: absolute;\r\n\t\ttop: -195rpx;\r\n\t\tleft: 0;\r\n\t\twidth: 600rpx;\r\n\t\theight: 270rpx;\r\n\t}\r\n\r\n\t.content-top-text {\r\n\t\tfont-size: 45rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #F8F8FA;\r\n\t\tposition: absolute;\r\n\t\ttop: 120rpx;\r\n\t\tleft: 50rpx;\r\n\t\tz-index: 1;\r\n\t}\r\n\r\n\t.content-header {\r\n\t\theight: 70rpx;\r\n\t}\r\n\r\n\t.title {\r\n\t\tfont-size: 33rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #3DA7FF;\r\n\t\tline-height: 38px;\r\n\t}\r\n\r\n\t.footer {\r\n\t\theight: 150rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-around;\r\n\t}\r\n\r\n\t.box-des-scroll {\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0 40rpx;\r\n\t\theight: 200rpx;\r\n\t\ttext-align: left;\r\n\t}\r\n\r\n\t.box-des {\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #000000;\r\n\t\tline-height: 50rpx;\r\n\t}\r\n\r\n\t.progress-box {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.progress {\r\n\t\twidth: 90%;\r\n\t\theight: 40rpx;\r\n\t\tborder-radius: 35px;\r\n\t}\r\n\r\n\t.close-img {\r\n\t\twidth: 70rpx;\r\n\t\theight: 70rpx;\r\n\t\tz-index: 1000;\r\n\t\tposition: absolute;\r\n\t\tbottom: -120rpx;\r\n\t\tleft: calc(50% - 70rpx / 2);\r\n\t}\r\n\r\n\t.content-button {\r\n\t\ttext-align: center;\r\n\t\tflex: 1;\r\n\t\tfont-size: 30rpx;\r\n\t\tfont-weight: 400;\r\n\t\tcolor: #FFFFFF;\r\n\t\tborder-radius: 40rpx;\r\n\t\tmargin: 0 18rpx;\r\n\r\n\t\theight: 80rpx;\r\n\t\tline-height: 80rpx;\r\n\r\n\t\tbackground: linear-gradient(to right, #1785ff, #3DA7FF);\r\n\t}\r\n\r\n\t.flex-column {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upgrade-popup.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upgrade-popup.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1663864338392\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}